
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dutch Auction v2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; text-align: center; }
    .hidden { display: none; }
    #price { font-size: 3rem; color: red; margin: 1rem 0; }
    input { padding: 0.5rem; font-size: 1rem; }
    button { padding: 0.7rem 1.5rem; font-size: 1.1rem; margin: 0.5rem; }
  </style>
</head>
<body>
  <div id="role-select">
    <h2>è«‹é¸æ“‡æ‚¨çš„èº«åˆ†</h2>
    <button onclick="setRole('host')">æˆ‘æ˜¯ä¸»æŒäºº</button>
    <button onclick="setRole('user')">æˆ‘æ˜¯åƒèˆ‡è€…</button>
  </div>

  <div id="host-login" class="hidden">
    <h3>è¼¸å…¥ä¸»æŒäººå¯†ç¢¼</h3>
    <input type="password" id="host-pw"><br>
    <button onclick="verifyHost()">ç™»å…¥</button>
    <p id="host-status"></p>
  </div>

  <div id="nickname-area" class="hidden">
    <h3>è«‹è¼¸å…¥æ‚¨çš„æš±ç¨±</h3>
    <input id="nickname">
    <button onclick="submitNickname()">é€å‡º</button>
  </div>

  <div id="auction" class="hidden">
    <h2 id="item-name">æ‹è³£å“ï¼š-</h2>
    <div id="price">-</div>
    <button id="bidBtn" onclick="bid()">æ¶æ¨™</button>
    <p id="result"></p>
  </div>

  <div id="host-panel" class="hidden">
    <button onclick="startAuction()">â–¶ï¸ é–‹å§‹æ‹è³£</button>
    <button onclick="endAuction()">â¹ï¸ çµæŸæ‹è³£</button>
    <p id="next-item">ä¸‹ä¸€ä»¶å°‡è‡ªå‹•è¼‰å…¥</p>
  </div>

  <script>
    const socket = io();
    let role = "", nickname = "";

    function setRole(r) {
      role = r;
      document.getElementById("role-select").classList.add("hidden");
      if (r === 'host') document.getElementById("host-login").classList.remove("hidden");
      else document.getElementById("nickname-area").classList.remove("hidden");
    }

    function verifyHost() {
      const pw = document.getElementById("host-pw").value;
      socket.emit('verify-host', pw);
    }

    socket.on('host-verified', ok => {
      if (ok) {
        document.getElementById("host-status").innerText = "âœ… é©—è­‰æˆåŠŸ";
        document.getElementById("host-login").classList.add("hidden");
        document.getElementById("host-panel").classList.remove("hidden");
        document.getElementById("auction").classList.remove("hidden");
      } else {
        document.getElementById("host-status").innerText = "âŒ å¯†ç¢¼éŒ¯èª¤";
      }
    });

    function submitNickname() {
      nickname = document.getElementById("nickname").value.trim();
      if (!nickname) return alert("è«‹è¼¸å…¥æš±ç¨±ï¼");
      socket.emit('set-nickname', nickname);
      document.getElementById("nickname-area").classList.add("hidden");
      document.getElementById("auction").classList.remove("hidden");
    }

    function startAuction() {
      socket.emit('start-auction');
    }

    function endAuction() {
      socket.emit('end-auction');
    }

    function bid() {
      socket.emit('bid');
    }

    socket.on('auction-started', data => {
      document.getElementById("item-name").innerText = "æ‹è³£å“ï¼š" + data.item;
      document.getElementById("price").innerText = "$" + data.startPrice;
      document.getElementById("result").innerText = "";
      document.getElementById("bidBtn").disabled = false;
      data.price = data.startPrice;
    });

    socket.on('price-updated', data => {
      document.getElementById("price").innerText = "$" + data.price;
    });

    socket.on('auction-won', data => {
      document.getElementById("result").innerText = `ğŸ‰ ${data.winner} ä»¥ $${data.price} å¾—æ¨™ ${data.item}`;
      document.getElementById("bidBtn").disabled = true;
    });

    socket.on('auction-ended', data => {
      document.getElementById("result").innerText = 'âš ï¸ æ‹è³£çµæŸï¼Œ' + (data.reason === 'no-bid' ? 'ç„¡äººå‡ºåƒ¹' : 'æ‰‹å‹•åœæ­¢');
      document.getElementById("bidBtn").disabled = true;
    });

    socket.on('next-item-ready', item => {
      document.getElementById("item-name").innerText = "ä¸‹ä¸€ä»¶æ‹è³£å“ï¼š" + item.item;
      document.getElementById("price").innerText = "$" + item.startPrice;
      document.getElementById("result").innerText = "ä¸‹ä¸€ä»¶å¯æ‰‹å‹•é–‹å§‹æ‹è³£";
    });
  </script>
</body>
</html>
